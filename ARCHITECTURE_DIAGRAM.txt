GRAFANA + PROMETHEUS ARCHITECTURE
==================================

┌─────────────────────────────────────────────────────────────────┐
│                        USER BROWSER                             │
│         http://localhost:3000 (Grafana Dashboard)              │
│                                                                  │
│  ┌────────────────────────────────────────────────────────┐   │
│  │   STAFF ATTENDANCE STATISTICS DASHBOARD                │   │
│  │   (Auto-refresh every 10 seconds)                       │   │
│  ├────────────────────────────────────────────────────────┤   │
│  │ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐      │   │
│  │ │ Present: 15 │ │ Absent: 3   │ │ Late: 2     │      │   │
│  │ │ (Green)     │ │ (Red)       │ │ (Yellow)    │      │   │
│  │ └─────────────┘ └─────────────┘ └─────────────┘      │   │
│  │ ┌───────────────────┐ ┌──────────────────────┐       │   │
│  │ │ Pie Chart:        │ │ 7-Day Trend Line:   │       │   │
│  │ │ Status Breakdown  │ │ Present/Absent/Late │       │   │
│  │ └───────────────────┘ └──────────────────────┘       │   │
│  └────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
                         │
          ┌──────────────┴──────────────┐
          │                             │
          ▼                             ▼
    ┌──────────────┐            ┌──────────────┐
    │  GRAFANA     │────HTTP───►│ PROMETHEUS   │
    │  Port: 3000  │◄───────────│ Port: 9090   │
    │              │            │              │
    │ Datasource:  │            │ Time-Series  │
    │ Prometheus   │            │ Database     │
    │              │            │              │
    │ Panels:      │            │ Retention:   │
    │ - Stats      │            │ 30 days      │
    │ - Charts     │            │              │
    │ - Tables     │            │ Scrape Rate: │
    │              │            │ 10 seconds   │
    └──────────────┘            └──────────────┘
                                       ▲
                                       │
                         ┌─────────────┘
                         │ Scrapes metrics
                         │ every 10 seconds
                         │
                         ▼
         ┌────────────────────────────────┐
         │   LARAVEL APP (Port 8000)      │
         │                                │
         │  GET /metrics                 │
         │  ├─ MetricsController         │
         │  ├─ Queries Database          │
         │  └─ Returns Prometheus Format │
         │                                │
         │  Metrics:                     │
         │  - attendance_present_today   │
         │  - attendance_absent_today    │
         │  - attendance_late_today      │
         │  - attendance_by_status       │
         │  - attendance_daily_*         │
         │  (All real-time from DB)      │
         └────────────────────────────────┘
                         ▲
                         │
                         ▼
         ┌────────────────────────────────┐
         │   MYSQL DATABASE               │
         │   (attendance table)           │
         │                                │
         │  Columns:                      │
         │  - staff_id                    │
         │  - attendance_date             │
         │  - status (6 types)            │
         │  - check_in_time               │
         │  - check_out_time              │
         │  - remarks                     │
         │                                │
         │  Port: 3307                   │
         │  Database: staffAttend_data   │
         └────────────────────────────────┘


DATA FLOW (Every 10 seconds)
============================

1. Browser loads Grafana dashboard (http://localhost:3000)
   └─► Grafana displays panels from cache initially

2. Dashboard refresh triggered (10s timer)
   └─► Grafana sends PromQL queries to Prometheus

3. Prometheus receives query (e.g., "attendance_present_today")
   └─► Checks internal time-series database
   └─► If data stale, initiates scrape immediately

4. Prometheus scrapes Laravel /metrics endpoint
   └─► HTTP GET http://localhost:8000/metrics
   └─► Receives metrics in Prometheus text format

5. MetricsController processes request
   └─► Queries MySQL database (last 7 days + today)
   └─► Calculates fresh statistics
   └─► Formats response in Prometheus format
   └─► Returns metrics

6. Prometheus stores metrics in time-series database
   └─► Organizes by metric name + labels
   └─► Maintains history for 30 days

7. Grafana receives query results
   └─► Updates dashboard panels
   └─► Displays real-time values + charts

8. Browser renders updated dashboard
   └─► User sees real-time attendance data
   └─► Cycle repeats every 10 seconds


AVAILABLE METRICS IN GRAFANA
==============================

Gauge Metrics (Real-time values):
├─ attendance_present_today          (People present today)
├─ attendance_absent_today           (People absent today)
├─ attendance_late_today             (People late today)
├─ attendance_el_today               (People on emergency leave)
├─ attendance_leave_today            (People on leave)
├─ attendance_halfday_today          (People on half day)
├─ attendance_total_staff            (Total with records today)
└─ attendance_by_status{status="X"}  (Breakdown by each status)

Time-Series Metrics (7+ days):
├─ attendance_daily_present          (Daily present trend)
├─ attendance_daily_absent           (Daily absent trend)
└─ attendance_daily_late             (Daily late trend)


PORTS & ACCESS
===============

Service              Port    URL                          Credentials
─────────────────────────────────────────────────────────────────────
Grafana              3000    http://localhost:3000        admin/admin
Prometheus           9090    http://localhost:9090        (open)
Laravel App          8000    http://localhost:8000        (login)
Laravel Metrics      8000    http://localhost:8000/metrics (open)
MySQL                3307    localhost:3307               root/root
phpMyAdmin           8081    http://localhost:8081        root/root


DOCKER VOLUMES (Persistent Storage)
=====================================

Volume           Purpose                              Size
────────────────────────────────────────────────────────────
prometheus_data  Time-series database storage         ~1GB/month
grafana_data     Dashboard configurations & plugins  ~500MB
mysql_data       Attendance records database         ~200MB


DOCKER NETWORK
===============

All services communicate through internal network: staff-network

service-name:port (internal, within Docker)
─────────────────────────────────────────
prometheus:9090     (accessible from Grafana)
mysql:3306          (accessible from Laravel)
host.docker.internal:8000  (for Prometheus to reach Windows/Mac host)


REFRESH INTERVALS
==================

Component                   Interval    Purpose
───────────────────────────────────────────────────
Browser to Grafana         10 seconds  Dashboard update
Grafana to Prometheus      10 seconds  Query execution
Prometheus to Laravel      10 seconds  Metrics scrape
Laravel Query to MySQL     Real-time   Data calculation
Data Retention             30 days     Historical storage


SECURITY
=========

Current Configuration (Development):
├─ Grafana: admin/admin (CHANGE IN PRODUCTION!)
├─ MySQL: root/root (CHANGE IN PRODUCTION!)
├─ Prometheus: No authentication
└─ Metrics: Open endpoint (add auth if needed)

Production Recommendations:
├─ Use strong passwords
├─ Add nginx reverse proxy
├─ Enable HTTPS/SSL
├─ Restrict /metrics endpoint access
└─ Use environment variables for secrets


PERFORMANCE CHARACTERISTICS
=============================

Metrics Calculation Time:    ~100ms (real-time queries)
Data Scrape Interval:        10 seconds
Dashboard Refresh Rate:      10 seconds
Query Timeout:               30 seconds (typical)
Maximum Concurrent Queries:  4
Data Retention:              30 days (14GB max)
Typical Monthly Storage:     ~1GB
CPU Usage:                   <5% (light)
Memory Usage:                ~500MB per container


CUSTOMIZATION OPTIONS
=======================

Metrics Refresh Rate:
└─ Edit: docker-compose.yml
   └─ Change: scrape_interval: 10s
   └─ To: scrape_interval: 30s (or desired interval)

Data Retention Period:
└─ Edit: docker-compose.yml
   └─ Change: --storage.tsdb.retention.time=30d
   └─ To: --storage.tsdb.retention.time=90d (or desired period)

Dashboard Refresh:
└─ In Grafana: Click dropdown (top right)
   └─ Select: 10s, 30s, 1m, or custom

Add New Metrics:
└─ Edit: app/Http/Controllers/MetricsController.php
   └─ Add: New metric queries and formatting
   └─ Return: In Prometheus text format


For detailed setup and troubleshooting, see:
─────────────────────────────────────────
README_GRAFANA.md
GRAFANA_PROMETHEUS_SETUP.md
TROUBLESHOOTING_GRAFANA.md
